%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Some custom packages
%

\RequirePackage{amsmath}
\RequirePackage{amssymb}
\RequirePackage{xspace}
\RequirePackage{listings}
\RequirePackage{booktabs}
\RequirePackage{makecell}
\RequirePackage{rotating}
\RequirePackage{pifont} 
\RequirePackage{tabularray} 
\RequirePackage{graphicx}
\RequirePackage{multirow}
\RequirePackage[tone]{tipa}

% For proper rendering and hyphenation of words containing Latin characters (including in bib files)
\RequirePackage[T1]{fontenc}
% This assumes your files are encoded as UTF8
\RequirePackage[utf8]{inputenc}
\RequirePackage{csquotes}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Fonts (like different typewriter fonts etc.)
%%
% \RequirePackage[scaled=.87]{couriers}
% \renewcommand\rmdefault{psb}
\RequirePackage{microtype}
\RequirePackage{inconsolata}

% ==== Math fonts
\RequirePackage{mathtools} % enhanced amsmath (e.g., adds \coloneqq)
\RequirePackage{amssymb}   % adds a lot of extra symbols (e.g., \mathbb{R})
\RequirePackage{amsthm}    % adds envs for theorems, lemmas, etc
\RequirePackage{bbm}       % mainly used for \mathbbm{1}

\RequirePackage{algorithm}
% \newcommand{\theHalgorithm}{\arabic{algorithm}}
\RequirePackage{algorithmic}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Style (Changing the visual style of chapter headings and stuff.)
%%
\RequirePackage{titlesec}
%\RequirePackage{lmodern}
% [Fixes issue #34 (see https://github.com/cambridge/thesis/issues/34). Solution from: http://tex.stackexchange.com/questions/299969/titlesec-loss-of-section-numbering-with-the-new-update-2016-03-15
\RequirePackage{etoolbox}
\makeatletter
\patchcmd{\ttlh@hang}{\parindent\z@}{\parindent\z@\leavevmode}{}{}
\patchcmd{\ttlh@hang}{\noindent}{}{}{}
\makeatother
% end of issue #34 fix]
\newcommand{\PreContentTitleFormat}{\titleformat{\chapter}[display]{\scshape\Large}
{\Large\filleft\MakeUppercase{\chaptertitlename} \Huge\thechapter}
{1ex}
{}
[\vspace{1ex}\titlerule]}
\newcommand{\ContentTitleFormat}{\titleformat{\chapter}[display]{\scshape\huge}
{\Large\filleft\MakeUppercase{\chaptertitlename} \Huge\thechapter}
{1ex}
{\titlerule\vspace{1ex}\filright}
[\vspace{1ex}\titlerule]}
\newcommand{\PostContentTitleFormat}{\PreContentTitleFormat}
\PreContentTitleFormat
\ContentTitleFormat



% Remove indentation and add space between paragraphs
\setlength{\parindent}{0pt}
\setlength{\parskip}{0.5em}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Other Style (Emojis, colours, etc)
%%
\RequirePackage{twemojis}
\RequirePackage{tcolorbox}      
\RequirePackage{xcolor}

\hypersetup{colorlinks,citecolor=blue,linkcolor=blue,urlcolor=blue}

\RequirePackage{cellspace}
\setlength\cellspacetoplimit{4pt}
\setlength\cellspacebottomlimit{4pt}
\RequirePackage{setspace}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% References (special style etc.)
%%
%\RequirePackage[numbers,sort&compress]{natbib}
\RequirePackage{natbib}
\RequirePackage[capitalise, noabbrev]{cleveref}
%\setlength{\parindent}{0pt}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Theorems, definitions, and examples
%%
\RequirePackage{amsthm}
\theoremstyle{definition}
\newtheorem{definition}{Definition}[chapter]
%% Support for `Examples` (provides a counter for examples, the possibility to
%% label and reference them etc.)
%%
\newtheorem{example}{Example}[chapter]
\tcbuselibrary{theorems}
\newtcbtheorem{question}{Research Question}{colback=green!5, colframe=green!35!black, fonttitle=\bfseries}{question}

% For boxes
\RequirePackage[nobreak=true]{mdframed}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Captions: This makes captions of figures use a boldfaced small font. 
%%
\RequirePackage[small,bf]{caption}
\RequirePackage{tablefootnote}
\RequirePackage{threeparttable}
\RequirePackage{rotating}
\RequirePackage{adjustbox}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Using sub caption instead of sub figure 
%%
\RequirePackage{subcaption}
%\RequirePackage{subfig}





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Graphics (we set the central folder for all included graphics to
%% `./Figures/`)
%%
\graphicspath{{./Figures/}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Content commands
%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Index
%%
\RequirePackage{imakeidx}
\makeindex

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Packages to help with drafting
%%
\setlength {\marginparwidth }{2cm} 
\RequirePackage[textsize=tiny]{todonotes}
\RequirePackage{enumitem}
\RequirePackage{xcolor}
\newenvironment{roughdraft}{\color{red}\itshape}{}
\newcommand{\rough}[1]{\textcolor{red}{\textit{#1}}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Other custom commands
%%
\newcommand{\ttipa}[1]{\textipa{#1}}
\newcommand{\ngram}{$n$-gram\xspace}
\newcommand{\ngrams}{$n$-grams\xspace}

\newcommand{\ex}[1]{\textit{\enquote{#1}}}
\newcommand\cincludegraphics[2][]{\raisebox{-0.3\height}{\includegraphics[#1]{#2}}}

% Scores
\newcommand{\fscore}{$F_1$ score\xspace}
\newcommand{\fscores}{$F_1$ scores\xspace}
\newcommand{\renyi}{R\'enyi\xspace}

% TOKENISERS
\newcommand{\bytespan}{\myemph{ByteSpan}\xspace}
\newcommand{\bpe}{\myemph{BPE}\xspace}
\newcommand{\bpewp}{\myemph{BPE-WP}\xspace}
\newcommand{\wordpiece}{\myemph{WP}\xspace}

% Datasets
\newcommand{\commoncorpus}{\myemph{Common-Corpus}\xspace}
\newcommand{\fineweb}{\myemph{FineWeb-Edu}\xspace}
\newcommand{\ipachildes}{\myemph{IPA CHILDES}\xspace}
\newcommand{\minipile}{\myemph{MiniPile}\xspace}

% Evaluation benchmarks
\newcommand{\blimp}{\myemph{BLiMP}\xspace}
\newcommand{\glue}{\myemph{GLUE}\xspace}

% Models
\newcommand{\gpt}{\myemph{\mbox{GPT-2}}\xspace}
\newcommand{\bert}{\myemph{BERT}\xspace}
\newcommand{\babyberta}{\myemph{BabyBERTa}\xspace}
\newcommand{\llama}{LLaMA\xspace}
\newcommand{\stela}{\myemph{STELA}\xspace}

% Resources
\newcommand{\phoible}[0]{Phoible\xspace}
\newcommand{\gpp}[0]{\myemph{G2P+}\xspace}
\newcommand{\phonemizer}[0]{\myemph{phonemizer}\xspace}
\newcommand{\epitran}[0]{\myemph{epitran}\xspace}
\newcommand{\pinyin}[0]{\myemph{pinyin-to-ipa}\xspace}
\newcommand{\pingyam}[0]{\myemph{pingyam}\xspace}

% Babble definitions
\newcommand{\cmark}{\ding{51}}%
\newcommand{\xmark}{\ding{55}}%
\makeatletter                             % automatically escape "_"
    \DeclareRobustCommand*{\escapeus}[1]{%
    \begingroup\@activeus\scantokens{#1\endinput}\endgroup}
    \begingroup\lccode`\~=`\_\relax
   \lowercase{\endgroup\def\@activeus{\catcode`\_=\active \let~\_}}
\makeatother
\newcommand{\myemph}[1]{\textsf{{\escapeus{#1}}}}
\definecolor{characters}{HTML}{40bcd8}
\definecolor{space}{HTML}{ff6663}
\definecolor{phoneme}{HTML}{ffcf99}

\newtcbox{\characterhighlight}{on line, colback=characters!50, boxrule=0.2mm, left=0.5mm, right=0.2mm, top=0.2mm, bottom=0.2mm}
\newtcbox{\spacehighlight}{on line, colback=space!50, boxrule=0.2mm, left=0.5mm, right=0.2mm, top=0.2mm, bottom=0.2mm}
\newtcbox{\phonemehighlight}{on line, colback=phoneme!50, boxrule=0.2mm, left=0.5mm, right=0.2mm, top=0.2mm, bottom=0.2mm}

% ByteSpan definitions
\definecolor{customgreen}{HTML}{3BAE2E}
\definecolor{customred}{HTML}{D13438}
\definecolor{customyellow}{HTML}{E0A000}
\newcommand{\green}[1]{\textcolor{customgreen}{#1}}
\newcommand{\red}[1]{\textcolor{customred}{#1}}
\newcommand{\yellow}[1]{\textcolor{customyellow}{#1}}

\newcommand{\tokeniser}{\mathbbm{T}}
\newcommand{\tok}{\tau}
\newcommand{\detok}{\ensuremath{\rotatebox[origin=c]{180}{$\tok$}}}

\newcommand{\vocab}{\mathcal{V}}
\newcommand{\subword}{v}
\newcommand{\subwordvec}{\mathbf{\subword}}

\newcommand{\alphabet}{\Sigma}
\newcommand{\ch}{b}
\newcommand{\chvec}{\mathbf{\ch}}

\newcommand{\merge}{m}
\newcommand{\mergevec}{\mathbf{\merge}}
\newcommand{\dataset}{\mathcal{D}}
\newcommand{\obfn}{\phi}
\newcommand{\bpeob}{\phi_{\text{\myemph{bpe}}}}
\newcommand{\wpob}{\phi_{\text{\myemph{wp}}}}
\newcommand{\countfn}{\#}
\newcommand{\surprisalfn}{I}
\newcommand{\lefttoken}{v_l}
\newcommand{\righttoken}{v_r}
\newcommand{\bytelm}{p}


% Math and number definitions

\usepackage[table-column-type=s]{siunitx}
\sisetup{
    mode = math, 
    text-family-to-math = true, 
    text-series-to-math = true, 
    reset-math-version = false, 
    quantity-product
}
\DeclareSIUnit\thousand{k}
\DeclareSIUnit\million{M}
\DeclareSIUnit\billion{B}
\DeclareSIUnit\trillion{T}
\DeclareSIUnit\x{x}
\DeclareSIUnit\percent{\%}
\DeclareSIUnit\hour{h}
\DeclareSIUnit\min{m}
\DeclareSIUnit\sec{s}
\DeclareSIUnit\gb{GB}
\newcommand{\integer}[1]{\num[mode = math, round-mode=places, round-precision=0, group-separator={,}, group-minimum-digits=4]{#1}\xspace}
\newcommand{\float}[2][1]{\num[group-digits=false, round-precision=#1, round-mode=places]{#2}\xspace}
\newcommand{\snum}[1]{\num{#1}\xspace}
\newcommand{\q}[2]{\qty[mode=math]{#1}{#2}\xspace}

\DeclareMathOperator*{\argmin}{argmin}
\DeclareMathOperator*{\argmax}{argmax}
\DeclareMathOperator*{\expect}{\mathbb{E}}
\DeclareMathOperator*{\variance}{\mathbb{V}}
\newcommand{\defeq}{\mathrel{\stackrel{\textnormal{\tiny def}}{=}}}
\newcommand{\smallcdots}{\cdots}
\newcommand{\smalldots}{...}
\newcommand{\R}{\mathbb{R}}
\newcommand{\size}[1]{{\left\vert #1 \right\vert}}
\newcommand{\one}{\mathbbm{1}}

\newcommand\mybox[2][]
{\tikz[overlay]\node[fill=blue!10,inner sep=1.3pt, anchor=text, rectangle, rounded corners=1mm,text height=1.5ex, #1] {#2};\phantom{#2}}

% Notes
\newcommand{\note}[4][]{\todo[author=#2,color=#3,size=\scriptsize,fancyline,caption={},#1]{#4}}
\newcommand{\zeb}[2][]{\note[#1]{zeb}{cyan!40}{#2}}
\newcommand{\Zeb}[2][]{\zeb[inline,#1]{#2}}
\newcommand{\response}[1]{\vspace{3pt}\hrule\vspace{3pt}\textbf{#1:}}
\newcommand{\addcites}{{\color{red} (add cites)}\xspace}
\newcommand{\writemore}{{\color{red} ... (write more)}\xspace}
\newcommand{\defn}[1]{\textbf{#1}}
\newcommand{\vs}{\emph{vs.}\@\xspace}
\newcommand{\thres}{\theta}
